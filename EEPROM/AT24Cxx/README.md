# STM32 AT24Cxx EEPROM 驱动库

> 💾 轻量级、可移植的 I²C EEPROM 驱动，支持 AT24C02 ~ AT24C256 全系列芯片，适用于 STM32 项目中的非易失性数据存储。 

## ✨ 核心特性

- ✅ 支持 **AT24C02 / C04 / C08 / C16 / C32 / C64 / C128 / C256** 等主流型号
- ✅ 自动适配 **不同页大小（8/16/32/64 字节）** 和 **地址模式（1字节/2字节地址）**
- ✅ 提供 **字节读写** 与 **页写入（Page Write）** 功能，提升写入效率
- ✅ 内置 **写入等待（ACK polling）**，确保 EEPROM 写入完成后再继续操作
- ✅ 支持 **任意长度数据读写**（`AT24CXX_ReadBuffer` / `AT24CXX_WriteBuffer`）
- ✅ 模块化设计：`at24cxx.h` 声明接口，`at24cxx.c` 实现逻辑
- ✅ 基于 **HAL_I2C** 或 **标准库 I²C**（底层接口可替换）

## 📁 文件结构

|             |                                                              |
| ----------- | ------------------------------------------------------------ |
| `at24cxx.h` | 驱动头文件：EEPROM 型号配置、函数声明、I²C 地址定义          |
| `at24cxx.c` | 驱动实现：初始化、读/写单字节、读/写缓冲区、页写入、设备检测等 |

## ⚙️ 使用说明

### 1. 硬件连接（典型 I²C 接法）

|            |                                |
| ---------- | ------------------------------ |
| VCC        | 3.3V                           |
| GND        | GND                            |
| SCL        | I2C1_SCL (PB6)                 |
| SDA        | I2C1_SDA (PB7)                 |
| A0, A1, A2 | 接 GND/VCC（用于设置设备地址） |

> 📌 **默认 I²C 地址**：`0xA0`（A2=A1=A0=GND 时），可在 `at24cxx.h` 中修改 `AT24CXX_I2C_ADDR` 

### 2. 配置 EEPROM 型号

在 `at24cxx.h` 中定义你的芯片型号：

\#define AT24CXX_TYPE    AT24C02   // 可选：AT24C02, AT24C32, AT24C64, AT24C256 等

驱动会自动根据型号设置：

- 总容量（字节）
- 页大小（Page Size）
- 地址字节数（1 或 2）

### 3. 初始化与使用

```c
// 初始化（通常只需确保 I2C 已初始化）

AT24CXX_Init();

// 写入单字节

AT24CXX_WriteOneByte(0x00, 0x55);

// 读取单字节

uint8_t data = AT24CXX_ReadOneByte(0x00);

// 写入缓冲区（自动分页处理）

uint8_t buf[] = "Hello EEPROM!";

AT24CXX_WriteBuffer(0x10, buf, sizeof(buf));

// 读取缓冲区

uint8_t read_buf[20];

AT24CXX_ReadBuffer(0x10, read_buf, sizeof(buf));
```



> ✅ **自动页写入**：`AT24CXX_WriteBuffer` 会自动按页边界切分数据，避免跨页写入失败。 

## 🛠️ 支持的 AT24Cxx 型号（常见）

| 型号     | 容量字节 | 页大小 | 地址位数 |
| -------- | -------- | ------ | -------- |
| AT24C02  | 256      | 8      | 1        |
| AT24C04  | 512      | 16     | 1        |
| AT24C08  | 1024     | 16     | 1        |
| AT24C16  | 2048     | 16     | 1        |
| AT24C32  | 4096     | 32     | 2        |
| AT24C64  | 8192     | 32     | 2        |
| AT24C128 | 16384    | 64     | 2        |
| AT24C256 | 32768    | 64     | 2        |

## 📌 注意事项

- **写入延时**：EEPROM 每页写入需 **5ms**，驱动已通过 **ACK Polling** 自动等待，无需手动延时
- **I²C 速率**：建议使用 **标准模式（100 kHz）**，部分芯片在 400 kHz 下可能不稳定
- **地址对齐**：页写入必须从页起始地址开始，驱动内部已处理
- **多设备支持**：通过修改 `AT24CXX_I2C_ADDR` 可支持多个 EEPROM（利用 A0~A2 引脚）

## 📦 依赖

- STM32 HAL 库（推荐）或标准外设库
- 已正确初始化 I²C 外设（如 `MX_I2C1_Init()`）

> 底层 I²C 调用位于 `AT24CXX_I2C_Read` 和 `AT24CXX_I2C_Write`，可轻松替换为自定义 I²C 实现。 

## 📄 许可证

GPL 3.0

## 🎯 典型应用场景

- 保存设备配置参数（如 WiFi 密码、校准数据）
- 记录运行日志或事件计数
- 系统掉电保护关键状态
- 替代 Flash 的小容量非易失存储

